<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multiplayer Snake Game</title>
  <style>
    canvas { border: 2px solid #000; background: #f2f2f2; }
  </style>
</head>
<body>
  <h2>Multiplayer Snake Game</h2>
  <canvas id="game" width="400" height="400"></canvas>

  <!-- Socket.IO Client -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    // âœ… UPDATED BACKEND URL
    const socket = io("https://snake-server-7quw.onrender.com");

    let players = {};

    socket.on("all-players", (data) => {
      players = data;
    });

    socket.on("new-player", (player) => {
      players[player.id] = player;
    });

    socket.on("player-left", (id) => {
      delete players[id];
    });

    socket.on("state-update", (data) => {
      players = data;
      draw();
    });

    let x = 50, y = 50, dx = 5, dy = 0;

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let id in players) {
        const p = players[id];
        ctx.fillStyle = id === socket.id ? "green" : "red";
        ctx.fillRect(p.x, p.y, 10, 10);
        ctx.fillText(`Score: ${p.score}`, p.x, p.y - 5);
      }
    }

    function gameLoop() {
      x += dx;
      y += dy;

      // wrap around
      if (x > canvas.width) x = 0;
      if (x < 0) x = canvas.width;
      if (y > canvas.height) y = 0;
      if (y < 0) y = canvas.height;

      socket.emit("move", { x, y });
    }

    setInterval(gameLoop, 100);

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") { dx = 0; dy = -5; }
      else if (e.key === "ArrowDown") { dx = 0; dy = 5; }
      else if (e.key === "ArrowLeft") { dx = -5; dy = 0; }
      else if (e.key === "ArrowRight") { dx = 5; dy = 0; }
    });
  </script>
</body>
</html>
